---
title: "Project 2: Unveiling Ecological Dynamics Through Simulation and Visualization of Biodiversity Data Cubes"
subtitle: "Framework architecture"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
---

```{r setup, message=FALSE, warning=FALSE}
# Setup
library(knitr)
library(here)
opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE)
opts_knit$set(root.dir = here())

# Packages
library(tidyverse)
library(sf)
```

# Introduction

# Project architecture



## Grid designation process
### Description

The function `grid_designation()` designates observations to cells of a given grid to create an aggregated data cube.

```
grid_designation(
    observations,
    grid,
    id_col = "row_names",
    seed = NA,
    aggregate = TRUE,
    randomisation = c("uniform", "normal"),
    p_norm = ifelse(tolower(randomisation[1]) ==  "uniform", NA, 0.95)) {
 ...
}
```

### Function arguments

**observations**:\\
An sf object with POINT geometry and a `coordinateUncertaintyInMeters` column. If this column is not present, the function will assume no (zero meters) uncertainty around the observation points.

**grid**:\\
An sf object with POLYGON geometry (usually a grid) to which observations should be designated.

**id_col**:\\
The column name of the column with unique ids for each grid cell. If `"row_names"` (the default), a new column `id` is created were the row names represent the unique ids.

**seed**:\\
The seed for random number generation to make results reproducible. If `NA` (the default), no seed is used.

**aggregate**:\\
Logical. If `TRUE` (default), return data cube in aggregated form (grid with number of observations per grid cell). Otherwise return sampled points in uncertainty circle.

**randomisation**:\\
`"uniform"` or `"normal"`. Randomisation method used for sampling within uncertainty circle around each observation. By default `"uniform"` which means each point uncertainty circle has an equal probability to be selected. The other option is `"normal"` where a point is sampled from a bivariate Normal distribution with means equal to the observation point and the variance equal to (-`coordinateUncertaintyInMeters`^2) / (2 * log(1 - `p_norm`)) such that `p_norm` % of all possible samples from this Normal distribution fall within the uncertainty circle.

**p_norm**:\\
A numeric value between 0 and 1. Only used if `randomisation = "normal"`. The proportion of all possible samples from a a bivariate Normal distribution that fall within the uncertainty circle. If normal randomisation is used and no value is given, the default `p_norm` value is 0.95.

### Returns

In case of `aggregate = TRUE`, an sf object with the number of observations, POLYGON geometry and minimal coordinate uncertainty per grid cell. In case of `aggregate = FALSE`, an sf object with POINT geometry of the sampled observations in the uncertainty circle and the coordinate uncertainty in meters related to the original observation.
